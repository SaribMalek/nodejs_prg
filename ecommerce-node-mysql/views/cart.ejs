<%- include('partials/header') %>

<h3>Your Cart</h3>

<% if (!items || items.length === 0) { %>
  <div class="alert alert-info">Your cart is empty. <a href="/">Continue shopping</a></div>
<% } else { %>
  <table class="table">
    <thead>
      <tr><th>Product</th><th width="120">Price</th><th width="120">Qty</th><th width="120">Subtotal</th><th></th></tr>
    </thead>
    <tbody>
      <% items.forEach(it => { %>
        <tr>
          <td><%= it.title %></td>
          <td>$<%= Number(it.price).toFixed(2) %></td>
          <td>
            <form action="/cart/update" method="POST" class="d-flex">
              <input type="hidden" name="productId" value="<%= it.id %>">
              <input type="number" name="qty" value="<%= it.qty %>" min="0" class="form-control form-control-sm me-2" style="width:80px;">
              <button class="btn btn-sm btn-outline-secondary">Update</button>
            </form>
          </td>
          <td>$<%= (it.qty * it.price).toFixed(2) %></td>
          <td>
            <form action="/cart/remove" method="POST" onsubmit="return confirm('Remove item?');">
              <input type="hidden" name="productId" value="<%= it.id %>">
              <button class="btn btn-sm btn-danger">Remove</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>

  <div class="d-flex justify-content-between align-items-center">
    <div>
      <a href="/" class="btn btn-outline-secondary">Continue shopping</a>
    </div>
    <div>
      <strong class="me-3">Total: $<%= Number(total).toFixed(2) %></strong>
      <form action="/checkout" method="POST" style="display:inline;">
        <button class="btn btn-success">Checkout</button>
      </form>
    </div>
  </div>
<% } %>

<%- include('partials/footer') %>
