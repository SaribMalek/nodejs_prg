<%- include('../partials/header') %>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Users</h3>
  <!-- create user form toggled inline -->
  <button class="btn btn-sm btn-primary" data-bs-toggle="collapse" data-bs-target="#createUser">Add user</button>
</div>

<div class="collapse mb-3" id="createUser">
  <div class="card card-body">
    <form action="/admin/users/create" method="POST" class="row g-2">
      <input name="name" class="form-control col-md-3" placeholder="Name" required>
      <input name="email" type="email" class="form-control col-md-3" placeholder="Email" required>
      <input name="password" type="password" class="form-control col-md-3" placeholder="Password" required>
      <select name="role" class="form-select col-md-2">
        <option value="user">User</option>
        <option value="admin">Admin</option>
      </select>
      <div class="col-md-1">
        <button class="btn btn-success w-100">Create</button>
      </div>
    </form>
  </div>
</div>

<table class="table table-striped">
  <thead>
    <tr><th>ID</th><th>Name</th><th>Email</th><th>Role</th><th>Created</th><th>Actions</th></tr>
  </thead>
  <tbody>
    <% users.forEach(u => { %>
      <tr>
        <td><%= u.id %></td>
        <td><%= u.name %></td>
        <td><%= u.email %></td>
        <td><%= u.role %></td>
        <td><%= new Date(u.created_at).toLocaleString() %></td>
        <td>
          <!-- Inline edit form (simple) -->
          <form action="/admin/users/edit/<%= u.id %>" method="POST" class="d-inline">
            <input name="name" value="<%= u.name %>" class="form-control form-control-sm d-inline" style="width:140px" required>
            <input name="email" value="<%= u.email %>" class="form-control form-control-sm d-inline" style="width:180px" required>
            <select name="role" class="form-select form-select-sm d-inline" style="width:110px">
              <option value="user" <%= u.role==='user' ? 'selected' : '' %>>User</option>
              <option value="admin" <%= u.role==='admin' ? 'selected' : '' %>>Admin</option>
            </select>
            <button class="btn btn-sm btn-primary">Save</button>
          </form>

          <form action="/admin/users/delete/<%= u.id %>" method="POST" class="d-inline" onsubmit="return confirm('Delete user?');">
            <button class="btn btn-sm btn-danger">Delete</button>
          </form>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>

<%- include('../partials/footer') %>
